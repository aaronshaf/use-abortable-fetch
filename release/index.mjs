import{useState as n,useEffect as t,useLayoutEffect as r,useRef as e}from"react";import o from"media-typer";import u from"content-type";const i=function(){function n(){}return n.prototype.then=function(t,r){const e=new n,o=this.s;if(o){const n=1&o?t:r;if(n){try{l(e,1,n(this.v))}catch(n){l(e,2,n)}return e}return this}return this.o=function(n){try{const o=n.v;1&n.s?l(e,1,t?t(o):o):r?l(e,1,r(o)):l(e,2,o)}catch(n){l(e,2,n)}},e},n}();function l(n,t,r){if(!n.s){if(r instanceof i){if(!r.s)return void(r.o=l.bind(null,n,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(l.bind(null,n,t),l.bind(null,n,2));n.s=t,n.v=r;const e=n.o;e&&e(n)}}const s={};!function(){function n(n){this._entry=n,this._pact=null,this._resolve=null,this._return=null,this._promise=null}function t(n){return{value:n,done:!0}}function r(n){return{value:n,done:!1}}n.prototype[Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))]=function(){return this},n.prototype._yield=function(n){return this._resolve(n&&n.then?n.then(r):r(n)),this._pact=new i},n.prototype.next=function(n){const r=this;return r._promise=new Promise(function(e){const o=r._pact;if(null===o){const n=r._entry;if(null===n)return e(r._promise);function u(n){r._resolve(n&&n.then?n.then(t):t(n)),r._pact=null,r._resolve=null}r._entry=null,r._resolve=e,n(r).then(u,function(n){if(n===s)u(r._return);else{const t=new i;r._resolve(t),r._pact=null,r._resolve=null,_resolve(t,2,n)}})}else r._pact=null,r._resolve=e,l(o,1,n)})},n.prototype.return=function(n){const r=this;return r._promise=new Promise(function(e){const o=r._pact;if(null===o)return null===r._entry?e(r._promise):(r._entry=null,e(n&&n.then?n.then(t):t(n)));r._return=n,r._resolve=e,r._pact=null,l(o,2,s)})},n.prototype.throw=function(n){const t=this;return t._promise=new Promise(function(r,e){const o=t._pact;if(null===o)return null===t._entry?r(t._promise):(t._entry=null,e(n));t._resolve=r,t._pact=null,l(o,2,n)})}}();export default function(i,l){void 0===l&&(l={});var s=n({data:null,loading:0,error:null,controller:null}),c=s[0],a=s[1],f=e(!1);return r(function(){return f.current=!0,function(){f.current=!1}},[]),t(function(){var n=new AbortController;return i&&(a(function(t){return{data:null,loading:t.loading+1,error:null,controller:n}}),function(n,t,r,e){try{var i=Object.assign({},t,{signal:r});Promise.resolve(function(t,r){try{var l=Promise.resolve(fetch(n,i)).then(function(n){function t(){e(function(n){return Object.assign({},n,{data:i,loading:n.loading-1})})}if(!n.ok){var r=new Error(n.statusText);throw r.status=n.status,r}var i=null,l=function(n){if(n){var t=u.parse(n),r=o.parse(t.type);if("json"===r.subtype)return!0;if("json"===r.suffix)return!0;if(r.suffix&&/\bjson\b/i.test(r.suffix))return!0;if(r.subtype&&/\bjson\b/i.test(r.subtype))return!0}return!1}(n.headers.get("content-type"))?Promise.resolve(n.json()).then(function(n){i=n}):Promise.resolve(n.text()).then(function(n){i=n});return l&&l.then?l.then(t):t()})}catch(n){return r(n)}return l&&l.then?l.then(void 0,r):l}(0,function(n){var t="AbortError"!==n.name?n:null;e(function(n){return Object.assign({},n,{error:t,loading:n.loading-1})})}))}catch(n){return Promise.reject(n)}}(i,l,n.signal,function(n){f.current&&a(n)})),function(){return n.abort()}},[i]),{data:c.data,loading:!!c.loading,error:c.error,abort:function(){return c.controller&&c.controller.abort()}}}
//# sourceMappingURL=index.mjs.map
