{"version":3,"file":"index.mjs","sources":["../src/index.ts"],"sourcesContent":["const { useState, useEffect, useLayoutEffect, useRef } = require('react');\r\n\r\nconst fetchData = (url, signal, setState) => {\r\n  fetch(url, { signal })\r\n    .then(rsp =>\r\n      rsp.ok\r\n        ? Promise.resolve(rsp)\r\n        : Promise.reject({\r\n            message: rsp.statusText,\r\n            status: rsp.status\r\n          })\r\n    )\r\n    .then(rsp => rsp.json())\r\n    .then(data => {\r\n      setState(oldState => ({\r\n        ...oldState,\r\n        data,\r\n        loading: oldState.loading - 1\r\n      }));\r\n    })\r\n    .catch(err => {\r\n      const error = err.name !== 'AbortError' ? err : null;\r\n\r\n      setState(oldState => ({\r\n        ...oldState,\r\n        error,\r\n        loading: oldState.loading - 1\r\n      }));\r\n    });\r\n};\r\n\r\nconst useAbortableFetch = url => {\r\n  const [state, setState] = useState({\r\n    data: null,\r\n    loading: 0,\r\n    error: null,\r\n    controller: null\r\n  });\r\n\r\n  const isMounted = useRef(false);\r\n  useLayoutEffect(() => {\r\n    isMounted.current = true;\r\n    return () => {\r\n      isMounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(\r\n    () => {\r\n      const controller = new AbortController();\r\n      setState(oldState => ({\r\n        data: null,\r\n        loading: oldState.loading + 1,\r\n        error: null,\r\n        controller\r\n      }));\r\n\r\n      fetchData(url, controller.signal, state => {\r\n        if (isMounted.current) {\r\n          setState(state);\r\n        }\r\n      });\r\n\r\n      return () => controller.abort();\r\n    },\r\n    [url]\r\n  );\r\n\r\n  return {\r\n    data: state.data,\r\n    loading: !!state.loading,\r\n    error: state.error,\r\n    abort: () => state.controller && state.controller.abort()\r\n  };\r\n};\r\n\r\nmodule.exports = useAbortableFetch;\r\n"],"names":["require","module","exports","url","useState","data","loading","error","controller","isMounted","useRef","useLayoutEffect","current","useEffect","AbortController","setState","oldState","signal","fetch","then","rsp","ok","Promise","resolve","reject","message","statusText","status","json","Object","catch","err","name","fetchData","state","abort"],"mappings":"MAAyDA,QAAQ,mEA4EjEC,OAAOC,iBA7CmBC,SACEC,EAAS,CACjCC,KAAM,KACNC,QAAS,EACTC,MAAO,KACPC,WAAY,qBAGRC,EAAYC,GAAO,UACzBC,oBACEF,EAAUG,SAAU,aAElBH,EAAUG,SAAU,IAErB,IAEHC,iBAEUL,EAAa,IAAIM,uBACvBC,WAASC,UACPX,KAAM,KACNC,QAASU,EAASV,QAAU,EAC5BC,MAAO,gBACPC,cApDWL,EAAKc,EAAQF,GAC9BG,MAAMf,EAAK,QAAEc,IACVE,cAAKC,UACJA,EAAIC,GACAC,QAAQC,QAAQH,GAChBE,QAAQE,OAAO,CACbC,QAASL,EAAIM,WACbC,OAAQP,EAAIO,WAGnBR,cAAKC,UAAOA,EAAIQ,SAChBT,cAAKd,GACJU,WAASC,UAAaa,iBACjBb,QACHX,EACAC,QAASU,EAASV,QAAU,QAG/BwB,eAAMC,OACCxB,EAAqB,eAAbwB,EAAIC,KAAwBD,EAAM,KAEhDhB,WAASC,UAAaa,iBACjBb,SACHT,EACAD,QAASU,EAASV,QAAU,QA+B9B2B,CAAU9B,EAAKK,EAAWS,gBAAQiB,GAC5BzB,EAAUG,SACZG,EAASmB,uBAIA1B,EAAW2B,UAE1B,CAAChC,IAGI,CACLE,KAAM6B,EAAM7B,KACZC,UAAW4B,EAAM5B,QACjBC,MAAO2B,EAAM3B,MACb4B,wBAAaD,EAAM1B,YAAc0B,EAAM1B,WAAW2B"}